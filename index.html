<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <title>버섯 식별기</title>
  <script src="https://cdn.jsdelivr.net/npm/@teachablemachine/image@0.8/dist/teachablemachine-image.min.js"></script>
</head>
<body>
  <h1>독버섯/식용버섯 식별기</h1>
  <input type="file" id="imageUpload" accept="image/*">
  <br><br>
  <img id="preview" src="" width="300" style="display:none;"/>
  <h2 id="result">예측 결과 없음</h2>
  <p id="description"></p>

  <script>
    const URL = "https://teachablemachine.withgoogle.com/models/tPNbIdtka/";

    let model, maxPredictions;

    async function init() {
      const modelURL = URL + "model.json";
      const metadataURL = URL + "metadata.json";

      model = await tmImage.load(modelURL, metadataURL);
      maxPredictions = model.getTotalClasses();
    }

    function getDescription(label) {
      const descriptions = {
        "양송이버섯": "[식용] 흰 갓, 부드러운 식감. 면역력 증진, 항산화 효과 있음.",
        "느타리버섯": "[식용] 회색 갓과 흰 줄기. 단백질 풍부, 심혈관 건강에 도움.",
        "광대버섯": "[독버섯] 붉은 갓과 흰 반점. 환각과 중추신경계 마비 유발.",
        "가을황토버섯": "[독버섯] 황토색 갓. 치명적 간 손상, 섭취 시 사망 위험.",
        "녹색포자 우산버섯": "[독버섯] 식용과 유사하나 맹독성. 구토, 설사, 신장 기능 저하."
      };
      return descriptions[label] || "정보 없음";
    }

    document.getElementById("imageUpload").addEventListener("change", async function (event) {
      const file = event.target.files[0];
      if (!file) return;

      const image = document.getElementById("preview");
      image.src = URL.createObjectURL(file);
      image.style.display = "block";

      const prediction = await model.predict(image);
      prediction.sort((a, b) => b.probability - a.probability);

      const best = prediction[0];
      document.getElementById("result").innerText = `예측 결과: ${best.className} (${(best.probability * 100).toFixed(1)}%)`;
      document.getElementById("description").innerText = getDescription(best.className);
    });

    window.onload = init;
  </script>
</body>
</html>
