<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>버섯 식별기</title>
  <script src="https://cdn.jsdelivr.net/npm/@teachablemachine/image@0.8/dist/teachablemachine-image.min.js"></script>
  <style>
    body { font-family:'Arial'; background:#f9f9f9; text-align:center; padding:40px; }
    h1 { font-size:36px; color:#111; }
    .guide { font-size:20px; margin:20px auto; max-width:800px; color:#444; }
    .warning { color:#c00; font-size:22px; font-weight:bold; margin-bottom:30px; }
    input[type="file"] { font-size:18px; margin-top:15px; }
    .description-container { background:#fff; padding:25px; border-radius:10px; max-width:700px; margin:30px auto; box-shadow:0 0 15px rgba(0,0,0,0.1); }
    .label { font-size:28px; font-weight:bold; color:#000; margin-bottom:15px; }
    .text { font-size:20px; color:#333; white-space:pre-line; text-align:left; }
  </style>
</head>
<body>
  <h1>독버섯/식용버섯 식별기</h1>
  <div class="guide">사진을 업로드하면 이름 + 설명 + 위험성(중요!)을 자동으로 알려줍니다.</div>
  <div class="warning">중요! 결과는 참고용입니다. 실제 식용 여부는 전문가에게 확인하세요.</div>
  <input type="file" id="imageUpload" accept="image/*">
  <div class="description-container">
    <div class="label" id="result">예측 결과 없음</div>
    <div class="text" id="description">사진을 올려주세요.</div>
  </div>

  <script>
    const URL = "https://teachablemachine.withgoogle.com/models/P0aEmmNoR/";
    let model;

    async function init() {
      try {
        model = await tmImage.load(URL + "model.json", URL + "metadata.json");
      } catch (e) {
        document.getElementById("description").innerText = "모델 로딩 실패";
        console.error(e);
      }
    }

    function getInfo(label) {
      const info = {
        "Galerina marginata": "이름: 가을황토버섯\n유형: 독버섯\n특징: 갈색 작은 갓. 팽이버섯과 혼동주의.\n위험성(중요!): 간/신장 손상, 치명적 중독 가능.",
        "Amanita muscaria": "이름: 광대버섯\n유형: 독버섯\n특징: 빨간 갓, 흰 반점. 환각유발.\n위험성(중요!): 중추신경 마비, 섭취 시 매우 위험.",
        "Amanita brunnescens": "이름: 녹색포자 우산버섯\n유형: 독버섯\n특징: 갈색 갓. 식용과 혼동 쉬움.\n위험성(중요!): 위장 장애, 심하면 입원 필요.",
        "Hericium erinaceus": "이름: 노루궁뎅이버섯\n유형: 식용버섯\n특징: 흰 털모양 외형. 신경·위 건강 도움.\n위험성: 안전하게 섭취 가능.",
        "Pleurotus ostreatus": "이름: 느타리버섯\n유형: 식용버섯\n특징: 회색 갓, 영양 풍부.\n위험성: 조리 후 섭취 권장."
      };
      return info[label] || "설명이 없습니다.";
    }

    document.getElementById("imageUpload").addEventListener("change", async e => {
      const file = e.target.files[0];
      if (!file) return;

      const reader = new FileReader();
      reader.onload = function(ev) {
        const img = new Image();
        img.onload = async function () {
          document.getElementById("result").innerText = "예측 중...";
          try {
            const prediction = await model.predict(img);
            const best = prediction.sort((a,b)=>b.probability-a.probability)[0];
            document.getElementById("result").innerText = `예측: ${best.className} (${(best.probability*100).toFixed(1)}%)`;
            document.getElementById("description").innerText = getInfo(best.className);
          } catch (err) {
            document.getElementById("description").innerText = "예측 실패: 모델 오류";
          }
        };
        img.src = ev.target.result;
      };
      reader.readAsDataURL(file);
    });

    init();
  </script>
</body>
</html>
