<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <title>버섯 식별기</title>
  <script src="https://cdn.jsdelivr.net/npm/@teachablemachine/image@0.8/dist/teachablemachine-image.min.js"></script>
  <style>
    body {
      font-family: 'Arial', sans-serif;
      text-align: center;
      background-color: #f7f7f7;
      padding: 30px;
    }
    h1 {
      color: #333;
    }
    img {
      margin-top: 20px;
      border-radius: 10px;
      box-shadow: 0 0 10px rgba(0,0,0,0.1);
    }
    .description-container {
      margin-top: 30px;
      background: white;
      padding: 20px;
      border-radius: 10px;
      max-width: 600px;
      margin-left: auto;
      margin-right: auto;
      box-shadow: 0 0 10px rgba(0,0,0,0.1);
    }
    .description-container img {
      max-width: 100%;
      height: auto;
    }
    .label {
      font-size: 24px;
      font-weight: bold;
      margin-top: 10px;
    }
    .text {
      font-size: 18px;
      margin-top: 10px;
      color: #555;
    }
  </style>
</head>
<body>
  <h1>독버섯/식용버섯 식별기</h1>
  <input type="file" id="imageUpload" accept="image/*">
  <br><br>
  <img id="preview" src="" width="300" style="display:none;"/>

  <div class="description-container">
    <img id="resultImage" src="" style="display:none;">
    <div class="label" id="result">예측 결과 없음</div>
    <div class="text" id="description"></div>
  </div>

  <script>
    const URL = "https://teachablemachine.withgoogle.com/models/tPNbIdtka/";

    let model, maxPredictions;

    async function init() {
      const modelURL = URL + "model.json";
      const metadataURL = URL + "metadata.json";
      model = await tmImage.load(modelURL, metadataURL);
      maxPredictions = model.getTotalClasses();
    }

    function getInfo(label) {
      const info = {
        "양송이버섯": {
          image: "10.png",
          text: "특징: 흰색의 둥근 갓과 짧은 줄기를 가진 식용버섯입니다.\n섭취 시 단백질과 항산화 성분이 풍부하여 면역력 강화에 도움을 줍니다.\n문제 없이 섭취 가능하지만 반드시 익혀 먹는 것이 좋습니다."
        },
        "느타리버섯": {
          image: "106.png",
          text: "특징: 회색의 갓과 흰 줄기를 가진 식용버섯으로 요리에 자주 사용됩니다.\n단백질과 식이섬유가 풍부하여 심혈관 건강에 좋습니다.\n보관 시 쉽게 물러지므로 냉장 보관하세요."
        },
        "광대버섯": {
          image: "Amanita muscaria_12.jpg",
          text: "특징: 선명한 빨간색 갓에 흰 반점이 있는 외형이 특징인 독버섯입니다.\n섭취 시 환각, 구토, 발작을 유발하며 소량만 먹어도 중독될 수 있습니다.\n절대 섭취하지 말고, 접촉 후 손을 씻어야 합니다."
        },
        "가을황토버섯": {
          image: "Galerina marginata_1.jpg",
          text: "특징: 노란색에서 갈색빛의 작은 갓을 가진 치명적인 독버섯입니다.\n섭취 시 간 손상 및 신장 기능 저하를 유발하고, 중증일 경우 사망에 이를 수 있습니다.\n팽이버섯과 비슷하게 생겨 주의가 필요합니다."
        },
        "녹색포자 우산버섯": {
          image: "Amanita brunnescens_1.jpg",
          text: "특징: 갓은 갈색 또는 황갈색이고, 표면은 매끄럽습니다.\n섭취 시 복통, 구토, 설사 등의 위장 장애를 일으키며, 심하면 입원 치료가 필요할 수 있습니다.\n식용버섯과 혼동하기 쉬워 특히 주의해야 합니다."
        }
      };
      return info[label] || { image: '', text: '정보 없음' };
    }

    document.getElementById("imageUpload").addEventListener("change", async function (event) {
      const file = event.target.files[0];
      if (!file) return;

      const image = document.getElementById("preview");
      image.src = URL.createObjectURL(file);
      image.style.display = "block";

      const prediction = await model.predict(image);
      prediction.sort((a, b) => b.probability - a.probability);

      const best = prediction[0];
      const info = getInfo(best.className);

      document.getElementById("result").innerText = `예측 결과: ${best.className} (${(best.probability * 100).toFixed(1)}%)`;
      const resultImage = document.getElementById("resultImage");
      resultImage.src = info.image;
      resultImage.style.display = "block";

      document.getElementById("description").innerText = info.text;
    });

    window.onload = init;
  </script>
</body>
</html>
